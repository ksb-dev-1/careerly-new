User visits Jobs Page
    â”‚
    â–¼
[Browser requests page from server]
    â”‚
    â–¼
Server receives /jobs request
    â”‚
    â–¼
Server runs fetchJobs(userId) WITH "use cache":
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ export async function fetchJobs(userId) â”‚
â”‚ {                                       â”‚
â”‚   "use cache";                          â”‚
â”‚   cacheTag(`jobs-${userId}`);           â”‚
â”‚   console.log("ğŸ”µ DB HIT");            â”‚ 
â”‚   // ... your Prisma query ...          â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Check Server Cache (in-memory, shared across all users):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Cache (global memory)          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Key: fn-hash + "user-123"       â”‚   â”‚
â”‚ â”‚ Status: âŒ EMPTY (first visit) â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
[Cache MISS] â†’ Execute fetchJobs function
    â”‚
    â–¼
DB HIT â†’ Fetch jobs
    â”‚
    â–¼
Server stores result in global cache:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Cache (global memory)          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Key: fn-hash + "user-123"       â”‚  â”‚
â”‚ â”‚ Status: âœ… CACHED                â”‚  â”‚
â”‚ â”‚ Data: {jobs: [...], ...}        â”‚  â”‚
â”‚ â”‚ Tags: ["jobs-user-123"]         â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Server renders HTML with jobs data embedded
    â”‚
    â–¼
Server sends complete HTML (no loading state)
    â”‚
    â–¼
Browser displays jobs list instantly
    â”‚
    â–¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
USER INTERACTIONS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. User navigates away and returns:
   â†’ Server cache HIT âœ… (same user)
   â†’ NO DB query
   â†’ NO function execution
   â†’ Instant HTML with cached data

2. User opens new tab:
   â†’ Same server cache HIT âœ… (global memory)
   â†’ NO DB query
   â†’ Instant HTML with cached data

3. User refreshes page (F5):
   â†’ Same server cache HIT âœ… (global memory)
   â†’ NO DB query
   â†’ Instant HTML with cached data

4. User bookmarks a job:
   â†’ POST /api/bookmark
   â†’ Server Action calls: revalidateTag(`jobs-${userId}`)
   â†’ Server cache INVALIDATED for this user
   â†’ Next visit: Cache MISS â†’ DB HIT â†’ Fresh data

5. Different user visits:
   â†’ Different cache key (different userId)
   â†’ Cache MISS (if first time for that user)
   â†’ DB HIT for that user
   â†’ Store in cache with different key

6. Server restart/redeploy:
   â†’ All cache cleared (in-memory)
   â†’ First visit after restart: Cache MISS â†’ DB HIT
   â†’ Rebuild cache for each user as they visit

          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ ALL USERS   â”‚
          â”‚ share same  â”‚
          â”‚ server      â”‚
          â”‚ cache pool  â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼            â–¼            â–¼
User A        User A        User B
(Chrome)     (Firefox)     (Chrome)
 Cache Hit    Cache Hit    Cache Miss*

// -------------------------------------

User visits Jobs Page
    â”‚
    â–¼
[Browser requests page from server]
    â”‚
    â–¼
Server sends HTML + JS bundle (including TanStack)
    â”‚
    â–¼
Browser renders initial HTML (empty/loading state)
    â”‚
    â–¼
TanStack Query mounts with queryClient config:
â”œâ”€â”€ staleTime: Infinity (never refetches while mounted)
â””â”€â”€ gcTime: Infinity (never garbage collects)
    â”‚
    â–¼
useQuery(['jobs', userId]) is called
    â”‚
    â–¼
Check TanStack Query Cache (in browser memory):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Cache (per browser tab/session)â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Key: ['jobs', 'user-123']       â”‚   â”‚
â”‚ â”‚ Status: âŒ EMPTY (first visit) â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
[Cache MISS] â†’ Make network request to /api/jobs
    â”‚
    â–¼
Server receives /api/jobs request
    â”‚
    â–¼
Server runs fetchJobs(userId)
    â”‚
    â–¼
DB HIT â†’ Fetch jobs
    â”‚
    â–¼
Server returns JSON response
    â”‚
    â–¼
TanStack Query stores in browser cache:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Cache (per browser tab/session)â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Key: ['jobs', 'user-123']       â”‚   â”‚
â”‚ â”‚ Status: âœ… CACHED              â”‚    â”‚
â”‚ â”‚ Data: {jobs: [...], ...}        â”‚   â”‚
â”‚ â”‚ staleTime: Infinity             â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Component re-renders with fetched data
    â”‚
    â–¼
Browser displays jobs list
    â”‚
    â–¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
USER INTERACTIONS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. User navigates away and returns:
   â†’ Cache HIT âœ… (staleTime: Infinity)
   â†’ NO network request
   â†’ Instant display

2. User opens new tab:
   â†’ New QueryClient instance
   â†’ Cache MISS (different memory space)
   â†’ Network request to /api/jobs
   â†’ New cache entry in this tab

3. User refreshes page (F5):
   â†’ Page reloads, cache cleared
   â†’ Cache MISS
   â†’ Network request to /api/jobs

4. User bookmarks a job:
   â†’ POST /api/bookmark
   â†’ Manually invalidate cache:
     queryClient.invalidateQueries({ 
       queryKey: ['jobs', userId] 
     })
   â†’ Network request to /api/jobs
   â†’ Update cache with fresh data

   User A Chrome Tab 1   User A Chrome Tab 2   User A Firefox
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Cache   â”‚           â”‚ Cache   â”‚         â”‚ Cache   â”‚
    â”‚ (Tab 1) â”‚           â”‚ (Tab 2) â”‚         â”‚ (Tab 1) â”‚
    â”‚ MISS    â”‚           â”‚ MISS    â”‚         â”‚ MISS    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                    â”‚
        â–¼                      â–¼                    â–¼
   API Request            API Request          API Request

// ----------------------------------------------------


Cache Strategy Comparison

Aspect                     | "use cache" (Server)           | TanStack Query (Client)
---------------------------|--------------------------------|-------------------------
Cache Location             | Server memory                  | Browser memory
Cross-tab Sharing          | Yes (same server instance)     | No (per tab/session)
Hard Refresh               | Cache persists                 | Cache lost
Initial Load               | Data in HTML (fast, no loading)| Requires JS execution
Dynamic Updates            | Needs manual revalidation      | Automatic refetching
Offline Support            | No                             | With PWA setup
Bundle Size                | Minimal (no client lib)        | Larger (TanStack bundle)
DB Load                    | Reduced (shared cache)         | Higher (per user/tab)
User-specific Data         | Cached per user                | Cached per user
Cache Persistence          | Across sessions                | Only within session
Network Requests           | Zero for cached users          | One per tab
First Contentful Paint     | Fast (HTML ready)              | Slower (needs JS)
Memory Usage               | Shared (efficient)             | Duplicated per tab
Deployment Scaling         | Cache lost on restart          | Survives server restarts
Real-time Updates          | Manual invalidation needed     | Easy with mutations
Developer Experience       | Simple (React patterns)        | Excellent (DevTools, hooks)
Learning Curve             | Low (built-in)                 | Medium (library to learn)
